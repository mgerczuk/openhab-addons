/**
 * Copyright (c) 2010-2021 Contributors to the openHAB project
 *
 * See the NOTICE file(s) distributed with this work for additional
 * information.
 *
 * This program and the accompanying materials are made available under the
 * terms of the Eclipse Public License 2.0 which is available at
 * http://www.eclipse.org/legal/epl-2.0
 *
 * SPDX-License-Identifier: EPL-2.0
 */
package org.openhab.binding.sma.internal.hardware.devices;

import static org.junit.jupiter.api.Assertions.fail;

import java.io.IOException;

import org.junit.jupiter.api.Test;
import org.openhab.binding.sma.internal.SmaBinding;
import org.openhab.binding.sma.internal.layers.BluetoothDebug;

/**
 * @author Martin Gerczuk - Initial contribution
 */
public class BluetoothSolarInverterPlantTest {
    @Test
    void testInit() {
        BluetoothDebug bt = new BluetoothDebug();
        bt.setDebugData(concat(readInit), writeInit);
        BluetoothSolarInverterPlant plant = new BluetoothSolarInverterPlant(
                new SmaBinding().createDevice("00:80:25:15:B6:06", "0000"));
        try {
            plant.init(bt);
        } catch (IOException e) {
            // TODO Auto-generated catch block
            fail(e.getMessage());
        }
    }

    static BluetoothDebug.ReadCall[] concat(BluetoothDebug.ReadCall[]... arrays) {
        int length = 0;
        for (BluetoothDebug.ReadCall[] array : arrays) {
            length += array.length;
        }
        BluetoothDebug.ReadCall[] result = new BluetoothDebug.ReadCall[length];
        int pos = 0;
        for (BluetoothDebug.ReadCall[] array : arrays) {
            for (BluetoothDebug.ReadCall element : array) {
                result[pos] = element;
                pos++;
            }
        }
        return result;
    }

    private static BluetoothDebug.WriteCall[] writeInit = new BluetoothDebug.WriteCall[] {
            new BluetoothDebug.WriteCall(new byte[] { 0x7E, 0x17, 0x00, 0x69, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01,
                    0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x02, 0x76, 0x65, 0x72, 0x0D, 0x0A }),
            new BluetoothDebug.WriteCall(new byte[] { 0x7E, 0x1F, 0x00, 0x61, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x06,
                    (byte) 0xB6, 0x15, 0x25, (byte) 0x80, 0x00, 0x02, 0x00, 0x00, 0x04, 0x70, 0x00, 0x04, 0x00, 0x00,
                    0x00, 0x00, 0x01, 0x00, 0x00, 0x00 }),
            new BluetoothDebug.WriteCall(new byte[] { 0x7E, 0x3F, 0x00, 0x41, 0x3C, 0x40, (byte) 0xB8, (byte) 0xEB,
                    0x27, (byte) 0xB8, (byte) 0xFF, (byte) 0xFF, (byte) 0xFF, (byte) 0xFF, (byte) 0xFF, (byte) 0xFF,
                    0x01, 0x00, 0x7E, (byte) 0xFF, 0x03, 0x60, 0x65, 0x09, (byte) 0xA0, (byte) 0xFF, (byte) 0xFF,
                    (byte) 0xFF, (byte) 0xFF, (byte) 0xFF, (byte) 0xFF, 0x00, 0x00, 0x7D, 0x5D, 0x00, 0x15, 0x60,
                    (byte) 0xAC, 0x37, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02, (byte) 0x80, 0x00, 0x02, 0x00, 0x00,
                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, (byte) 0xDE, 0x6B, 0x7E }),
            new BluetoothDebug.WriteCall(new byte[] { 0x7E, 0x3B, 0x00, 0x45, 0x3C, 0x40, (byte) 0xB8, (byte) 0xEB,
                    0x27, (byte) 0xB8, (byte) 0xFF, (byte) 0xFF, (byte) 0xFF, (byte) 0xFF, (byte) 0xFF, (byte) 0xFF,
                    0x01, 0x00, 0x7E, (byte) 0xFF, 0x03, 0x60, 0x65, 0x08, (byte) 0xA0, (byte) 0xFF, (byte) 0xFF,
                    (byte) 0xFF, (byte) 0xFF, (byte) 0xFF, (byte) 0xFF, 0x00, 0x03, 0x7D, 0x5D, 0x00, 0x15, 0x60,
                    (byte) 0xAC, 0x37, 0x00, 0x03, 0x00, 0x00, 0x00, 0x00, 0x03, (byte) 0x80, 0x0E, 0x01, (byte) 0xFD,
                    (byte) 0xFF, (byte) 0xFF, (byte) 0xFF, (byte) 0xFF, (byte) 0xFF, 0x4E, (byte) 0xCD, 0x7E

            }) };

    private static BluetoothDebug.ReadCall[] readInit = new BluetoothDebug.ReadCall[] {
            new BluetoothDebug.ReadCall(18,
                    new byte[] { 0x7E, 0x1F, 0x00, 0x61, 0x06, (byte) 0xB6, 0x15, 0x25, (byte) 0x80, 0x00, 0x00, 0x00,
                            0x00, 0x00, 0x00, 0x00, 0x02, 0x00, }),
            new BluetoothDebug.ReadCall(13,
                    new byte[] { 0x00, 0x04, 0x70, 0x00, 0x04, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00 }),
            new BluetoothDebug.ReadCall(18,
                    new byte[] { 0x7E, 0x1F, 0x00, 0x61, 0x06, (byte) 0xB6, 0x15, 0x25, (byte) 0x80, 0x00, 0x00, 0x00,
                            0x00, 0x00, 0x00, 0x00, 0x0A, 0x00 }),
            new BluetoothDebug.ReadCall(13,
                    new byte[] { 0x06, (byte) 0xB6, 0x15, 0x25, (byte) 0x80, 0x00, 0x01, 0x3C, 0x40, (byte) 0xB8,
                            (byte) 0xEB, 0x27, (byte) 0xB8 }),
            new BluetoothDebug.ReadCall(18,
                    new byte[] { 0x7E, 0x14, 0x00, 0x6A, 0x06, (byte) 0xB6, 0x15, 0x25, (byte) 0x80, 0x00, 0x00, 0x00,
                            0x00, 0x00, 0x00, 0x00, 0x0C, 0x00 }),
            new BluetoothDebug.ReadCall(2, new byte[] { 0x02, 0x00 }),
            new BluetoothDebug.ReadCall(18,
                    new byte[] { 0x7E, 0x2A, 0x00, 0x54, 0x06, (byte) 0xB6, 0x15, 0x25, (byte) 0x80, 0x00, 0x00, 0x00,
                            0x00, 0x00, 0x00, 0x00, 0x05, 0x00 }),
            new BluetoothDebug.ReadCall(24,
                    new byte[] { 0x54, 0x2D, 0x15, 0x25, (byte) 0x80, 0x00, 0x01, 0x01, 0x06, (byte) 0xB6, 0x15, 0x25,
                            (byte) 0x80, 0x00, 0x01, 0x01, 0x3C, 0x40, (byte) 0xB8, (byte) 0xEB, 0x27, (byte) 0xB8,
                            0x02, 0x01 }),
            new BluetoothDebug.ReadCall(18,
                    new byte[] { 0x7E, 0x12, 0x00, 0x6C, 0x06, (byte) 0xB6, 0x15, 0x25, (byte) 0x80, 0x00, 0x00, 0x00,
                            0x00, 0x00, 0x00, 0x00, 0x06, 0x00 }),
            new BluetoothDebug.ReadCall(18,
                    new byte[] { 0x7E, 0x30, 0x00, 0x4E, 0x06, (byte) 0xB6, 0x15, 0x25, (byte) 0x80, 0x00, 0x00, 0x00,
                            0x00, 0x00, 0x00, 0x00, 0x01, 0x10 }),
            new BluetoothDebug.ReadCall(30,
                    new byte[] { 0x54, 0x2D, 0x15, 0x25, (byte) 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                            0x00, 0x00 }),
            new BluetoothDebug.ReadCall(18,
                    new byte[] { 0x7E, 0x6A, 0x00, 0x14, 0x06, (byte) 0xB6, 0x15, 0x25, (byte) 0x80, 0x00, 0x3C, 0x40,
                            (byte) 0xB8, (byte) 0xEB, 0x27, (byte) 0xB8, 0x01, 0x00 }),
            new BluetoothDebug.ReadCall(88,
                    new byte[] { 0x7E, (byte) 0xFF, 0x03, 0x60, 0x65, 0x7D, 0x33, (byte) 0x90, 0x7D, 0x5D, 0x00, 0x15,
                            0x60, (byte) 0xAC, 0x37, 0x00, 0x00, 0x71, 0x00, 0x2D, 0x38, 0x2F, 0x7D, 0x5D, 0x00, 0x00,
                            0x00, 0x00, 0x00, 0x00, 0x02, (byte) 0x80, 0x01, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                            0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x00, 0x00, 0x00, (byte) 0xFF, 0x00, 0x00, (byte) 0x80,
                            0x07, 0x00, 0x60, 0x01, 0x00, 0x71, 0x00, 0x2D, 0x38, 0x2F, 0x7D, 0x5D, 0x00, 0x00, 0x0A,
                            0x00, 0x0C, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x00, 0x00, 0x00, 0x01, 0x01,
                            0x00, 0x00, (byte) 0xC6, 0x0F, 0x7E }),
            new BluetoothDebug.ReadCall(18,
                    new byte[] { 0x7E, 0x69, 0x00, 0x17, 0x54, 0x2D, 0x15, 0x25, (byte) 0x80, 0x00, 0x3C, 0x40,
                            (byte) 0xB8, (byte) 0xEB, 0x27, (byte) 0xB8, 0x01, 0x00 }),
            new BluetoothDebug.ReadCall(87,
                    new byte[] { 0x7E, (byte) 0xFF, 0x03, 0x60, 0x65, 0x7D, 0x33, (byte) 0x80, 0x7D, 0x5D, 0x00, 0x15,
                            0x60, (byte) 0xAC, 0x37, 0x00, 0x00, 0x63, 0x00, (byte) 0xC5, 0x68, 0x49, 0x77, 0x00, 0x00,
                            0x00, 0x00, 0x00, 0x00, 0x02, (byte) 0x80, 0x01, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                            0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x00, 0x00, 0x00, (byte) 0xFF, 0x00, 0x00, 0x58, 0x07,
                            0x00, 0x00, 0x01, 0x00, 0x63, 0x00, (byte) 0xC5, 0x68, 0x49, 0x77, 0x00, 0x00, 0x0A, 0x00,
                            0x0C, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x00, 0x00, 0x00, 0x01, 0x01, 0x00,
                            0x00, (byte) 0xE8, 0x7D, 0x33, 0x7E }),
            /*
             * getSignalStrength
             * new BluetoothDebug.ReadCall(18, new byte[] {
             * 0x7E, 0x18, 0x00, 0x66, 0x54, 0x2D, 0x15, 0x25, (byte) 0x80, 0x00,
             * 0x3C, 0x40, (byte) 0xB8, (byte) 0xEB, 0x27, (byte) 0xB8, 0x04, 0x00}),
             * new BluetoothDebug.ReadCall(6, new byte[] {
             * 0x05, 0x00,
             * 0x00, 0x00, (byte) 0xC5, 0x00}),
             */
            // logonSMAInverter(Inverters, cfg.userGroup, cfg.SMA_Password)

            new BluetoothDebug.ReadCall(18,
                    new byte[] { 0x7E, 0x54, 0x00, 0x2A, 0x06, (byte) 0xB6, 0x15, 0x25, (byte) 0x80, 0x00, 0x3C, 0x40,
                            (byte) 0xB8, (byte) 0xEB, 0x27, (byte) 0xB8, 0x01, 0x00 }),
            new BluetoothDebug.ReadCall(66,
                    new byte[] { 0x7E, (byte) 0xFF, 0x03, 0x60, 0x65, 0x0E, 0x50, 0x7D, 0x5D, 0x00, 0x15, 0x60,
                            (byte) 0xAC, 0x37, 0x00, 0x01, 0x71, 0x00, 0x2D, 0x38, 0x2F, 0x7D, 0x5D, 0x00, 0x01, 0x00,
                            0x00, 0x00, 0x00, 0x04, (byte) 0x80, 0x0D, 0x04, (byte) 0xFD, (byte) 0xFF, 0x07, 0x00, 0x00,
                            0x00, (byte) 0x84, 0x03, 0x00, 0x00, (byte) 0xE5, (byte) 0xB7, (byte) 0xFD, 0x59, 0x00,
                            0x00, 0x00, 0x00, (byte) 0xB8, (byte) 0xB8, (byte) 0xB8, (byte) 0xB8, (byte) 0x88,
                            (byte) 0x88, (byte) 0x88, (byte) 0x88, (byte) 0x88, (byte) 0x88, (byte) 0x88, (byte) 0x88,
                            (byte) 0xF2, 0x09, 0x7E }),

            new BluetoothDebug.ReadCall(18,
                    new byte[] { 0x7E, 0x47, 0x00, 0x39, 0x54, 0x2D, 0x15, 0x25, (byte) 0x80, 0x00, 0x3C, 0x40,
                            (byte) 0xB8, (byte) 0xEB, 0x27, (byte) 0xB8, 0x01, 0x00 }),
            new BluetoothDebug.ReadCall(53,
                    new byte[] { 0x7E, (byte) 0xFF, 0x03, 0x60, 0x65, 0x0B, (byte) 0x80, 0x7D, 0x5D, 0x00, 0x15, 0x60,
                            (byte) 0xAC, 0x37, 0x00, 0x01, 0x63, 0x00, (byte) 0xC5, 0x68, 0x49, 0x77, 0x00, 0x01, 0x00,
                            0x00, 0x00, 0x00, 0x04, (byte) 0x80, 0x0D, 0x04, (byte) 0xFD, (byte) 0xFF, 0x07, 0x00, 0x00,
                            0x00, (byte) 0x84, 0x03, 0x00, 0x00, (byte) 0xE5, (byte) 0xB7, (byte) 0xFD, 0x59, 0x00,
                            0x00, 0x00, 0x00, 0x08, (byte) 0xF1, 0x7E }) };
}
